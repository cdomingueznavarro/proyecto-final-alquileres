<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.prime.com.tr/ui" 
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:comps="http://java.sun.com/jsf/composite/comps">

    <body>

        <ui:composition template="./../../resources/templates/masterPage.xhtml">

            <ui:define name="logInfo">
                <h:form>
                    <h:commandLink value="Inicio" action="inicio.xhtml" />
                </h:form>
            </ui:define>

            <ui:define name="principal">
                <h:outputScript library="javascript" name="util.js" />
                <h:form id="form">
                    <h1>Modificar datos</h1>
                    <h:panelGrid columns="3" >

                        <h:outputLabel value="Telefono" />
                        <p:inputText id="telefono" value="#{modUsuario.telefono}" />
                        <p:message for="telefono" />

                        <h:outputLabel value="Fecha de nacimiento" />
                        <p:calendar id="fecha" value="#{modUsuario.fechaNacimiento}" navigator="true" 
                                    maxdate="#{usuario.today}" yearRange="c-80:c" required="true"
                                    requiredMessage="Valor requerido"/>
                        <p:message for="fecha" />

                        <h:outputLabel value="Pais" />
                        <h:selectOneMenu id="pais" value="#{modUsuario.paisSeleccionado}" required="true"
                                         requiredMessage="Valor requerido" >
                            <f:selectItem itemLabel="Seleccione un pais" itemValue="" />
                            <f:selectItems value="#{modUsuario.paises}" />
                            <p:ajax event="change" update="provincia agregar table growl" process="@this"
                                    listener="#{modUsuario.actualizarProvincias}" />
                        </h:selectOneMenu>
                        <p:message for="pais" />

                        <h:outputLabel value="Provincia" />
                        <h:selectOneMenu id="provincia" value="#{modUsuario.provinciaSeleccionada}" 
                                         required="true" requiredMessage="Valor requerido" >
                            <f:selectItem itemLabel="Seleccione una provincia" itemValue="" />
                            <f:selectItems value="#{modUsuario.provincias}" />
                            <p:ajax event="change" process="@this" update="agregar table" 
                                    listener="#{modUsuario.prepararDomicilio}" />
                        </h:selectOneMenu>
                        <p:message for="provincia" />
                        
                        <p:commandButton value="Agregar domicilio" type="button" id="agregar"
                                         disabled="#{modUsuario.paisSeleccionado == 0 or modUsuario.provinciaSeleccionada == 0}"
                                         onclick="dialogoDom.show();" />

                    </h:panelGrid>

                    <p:dataTable id="table" value="#{modUsuario.domicilios}" var="dom" >
                        <f:facet name="header" >
                            Domicilios cargados
                        </f:facet>

                        <p:column headerText="Calle" >
                            <p:cellEditor>
                                <f:facet name="output" >
                                    <h:outputText value="#{dom.calle}" />
                                </f:facet>
                                <f:facet name="input" >
                                    <p:inputText value="#{dom.calle}" required="true" />
                                </f:facet>
                            </p:cellEditor>
                        </p:column>

                        <p:column headerText="Numero" >
                            <p:cellEditor>
                                <f:facet name="output" >
                                    <h:outputText value="#{dom.numero}" />
                                </f:facet>
                                <f:facet name="input" >
                                    <p:inputText value="#{dom.numero}" required="true" />
                                </f:facet>
                            </p:cellEditor>
                        </p:column>

                        <p:column headerText="Piso" >
                            <p:cellEditor>
                                <f:facet name="output" >
                                    <h:outputText value="#{dom.piso}" />
                                </f:facet>
                                <f:facet name="input" >
                                    <p:inputText value="#{dom.piso}" />
                                </f:facet>
                            </p:cellEditor>
                        </p:column>

                        <p:column headerText="Depto" >
                            <p:cellEditor>
                                <f:facet name="output" >
                                    <h:outputText value="#{dom.depto}" />
                                </f:facet>
                                <f:facet name="input" >
                                    <p:inputText value="#{dom.depto}" />
                                </f:facet>
                            </p:cellEditor>
                        </p:column>

                        <p:column headerText="Barrio" >
                            <p:cellEditor>
                                <f:facet name="output" >
                                    <h:outputText value="#{dom.barrio}" />
                                </f:facet>
                                <f:facet name="input" >
                                    <p:inputText value="#{dom.barrio}" required="true" />
                                </f:facet>
                            </p:cellEditor>
                        </p:column>

                        <p:column headerText="Ciudad" >
                            <p:cellEditor>
                                <f:facet name="output" >
                                    <h:outputText value="#{dom.ciudad}" />
                                </f:facet>
                                <f:facet name="input" >
                                    <p:inputText value="#{dom.ciudad}" required="true" />
                                </f:facet>
                            </p:cellEditor>
                        </p:column>

                        <p:column headerText="Opciones" >
                            <p:rowEditor />
                            <p:commandButton update="table" oncomplete="confirmacion.show()" 
                                             process="table" image="ui-icon ui-icon-trash" 
                                             title="Quitar" >
                                <f:setPropertyActionListener value="#{dom}" target="#{modUsuario.domicilioSeleccionado}" />
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>

                    <p:confirmDialog message="Esta seguro?" width="200" header="Confirmar"
                                     severity="alert" widgetVar="confirmacion" >
                        <p:commandButton value="Si" update="table" actionListener="#{modUsuario.borrarDomicilio}"
                                         oncomplete="confirmacion.hide()" process="table" />
                        <p:commandButton value="No" onclick="confirmacion.hide()" type="button" />
                    </p:confirmDialog>

                    <p:growl id="growl" globalOnly="true" />
                </h:form>
                
                <p:dialog id="dialogo" header="Agregar Domicilio" widgetVar="dialogoDom" >
                    <h:form id="domDialog">
                        <h:panelGrid columns="3" cellpadding="2" >
                            <h:outputLabel value="Calle" />
                            <p:inputText id="calle" value="#{modUsuario.calle}" required="true"
                                         requiredMessage="Valor requerido"/>
                            <p:message for="calle" display="icon" />
                            <h:outputLabel value="Numero" />
                            <p:inputText id="numero" value="#{modUsuario.numero}" required="true"
                                         requiredMessage="Valor requerido"/>
                            <p:message for="numero" display="icon" />
                            <h:outputLabel value="Piso" />
                            <p:inputText value="#{modUsuario.piso}" />
                            <p/>
                            <h:outputLabel value="Depto" />
                            <p:inputText value="#{modUsuario.depto}" />
                            <p/>
                            <h:outputLabel value="Barrio" />
                            <p:inputText id="barrio" value="#{modUsuario.barrio}" required="true"
                                         requiredMessage="Valor requerido"/>
                            <p:message for="barrio" display="icon" />
                            <h:outputLabel value="Ciudad" />
                            <p:inputText id="ciudad" value="#{modUsuario.ciudad}" required="true"
                                         requiredMessage="Valor requerido"/>
                            <p:message for="ciudad" display="icon" />
                            <f:facet name="footer" >
                                <p:commandButton value="Agregar" actionListener="#{modUsuario.agregarDomicilio}"
                                                 oncomplete="handleAgregarDomicilio(xhr, status, args)"
                                                 update="@form :form:table :form:growl"/>
                                <p:commandButton value="Limpiar" type="reset" />
                            </f:facet>
                        </h:panelGrid>
                    </h:form>
                </p:dialog>

            </ui:define>

            <ui:define name="right">
                <comps:loginBox />
            </ui:define>

        </ui:composition>

    </body>
</html>
